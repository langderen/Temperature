C51 COMPILER V9.57.0.0   MAIN                                                              12/24/2025 13:59:20 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: E:\UV4\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst
                    -) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Timer0.h"
   3          #include "Key.h"
   4          #include "Nixie.h"
   5          #include "Delay.h"
   6          #include "AT24C02.h"
   7          #include "Buzzer.h"
   8          #include "DS18B20.h"
   9          #include "UART.h"
  10          #include <stdio.h>
  11          //Ê≥¢ÁâπÁéá‰∏∫9600
  12          unsigned char KeyNum;
  13          int Hour=0,Min=1,Sec=1,tmp;
  14          unsigned char RunFlag,Buzz=0;
  15          unsigned char index=0;
  16          float T;
  17          bit SendUARTFlag = 0;      // 1ÁßíÂà∞Êó∂ÁöÑÂèëÈÄÅÊ†áÂøó
  18          char UART_Str[30];         // Ë∂≥Â§üÂÆπÁ∫≥ "99:59:59 --> 99.99\r\n"
  19          bit UART_Busy = 0;  // ‰∏≤Âè£ÂøôÁ¢åÊ†áÂøó‰Ωç
  20          
  21          
  22          void main()
  23          {
  24   1        
  25   1        Timer0_Init();
  26   1        UART_Init();
  27   1        DS18B20_ConvertT();   //‰∏äÁîµÂÖàËΩ¨Êç¢‰∏ÄÊ¨°Ê∏©Â∫¶ÔºåÈò≤Ê≠¢Á¨¨‰∏ÄÊ¨°ËØªÊï∞ÊçÆÈîôËØØ
  28   1        Delay(1000);      //Á≠âÂæÖËΩ¨Êç¢ÂÆåÊàê
  29   1        
  30   1        while(1)
  31   1        {
  32   2          KeyNum=Key();
  33   2      
  34   2          if(KeyNum==1)     //K1ÊåâÈîÆÊåâ‰∏ãÁî®‰∫éÂêØÂä®ÊàñÊöÇÂÅúËÆ°Êó∂ËøáÁ®ã
  35   2          {
  36   3            RunFlag=!RunFlag; //ÂêØÂä®Ê†áÂøó‰ΩçÁøªËΩ¨
  37   3          }
  38   2          if(KeyNum==2)     //K2ÊåâÈîÆÊåâ‰∏ãÁî®‰∫éËÆ°Êó∂Ê∏ÖÈõ∂ÂèäÁ≥ªÁªüÂ§ç‰Ωç
  39   2          { 
  40   3            RunFlag=0;
  41   3            Hour=0;         //ÂàÜÁßíÊ∏Ö0
  42   3            Min=1;        
  43   3            Sec=1;
  44   3            Buzz=0;         //ÊöÇÂÅúËúÇÈ∏£Âô®
  45   3            tmp=(int)(T*100);     
  46   3            AT24C02_WriteByte(0,tmp/100);//Ê∏©Â∫¶ËÆ°Êï¥Êï∞ÈÉ®ÂàÜ
  47   3            AT24C02_WriteByte(1,tmp%100);
  48   3      
  49   3          }
  50   2          if(KeyNum==3)     //K3ÊåâÈîÆÊåâ‰∏ãÁî®‰∫éÂàáÊç¢ËÆ°Êó∂Ê°£‰Ωç
  51   2          {
  52   3            if(++index>2)index=0;
  53   3      
  54   3          }
C51 COMPILER V9.57.0.0   MAIN                                                              12/24/2025 13:59:20 PAGE 2   

  55   2          if(KeyNum==4&&!RunFlag)     //K4ÊåâÈîÆÊåâ‰∏ãÁî®‰∫éÂØπÂΩìÂâçËÆ°Êó∂Êó∂Èó¥ËøõË°åÈÄêÊ¨°Â¢ûÂä†ÔºåÊúÄÂ∞èÊ≠•Èïø‰∏
             -∫1
  56   2          {
  57   3            if(index==0)Sec++;
  58   3            else if(index==1)Min++;
  59   3            else Hour++;
  60   3            
  61   3            if(Sec >= 60) Sec = 0;
  62   3            if(Min >= 60) Min = 0;
  63   3            if(Hour >= 99) Hour = 0;
  64   3          }
  65   2          Nixie_SetBuf(1,Hour/10);  //ËÆæÁΩÆÊòæÁ§∫ÁºìÂ≠òÔºåÊòæÁ§∫Êï∞ÊçÆ
  66   2          Nixie_SetBuf(2,Hour%10);
  67   2          Nixie_SetBuf(3,11);
  68   2          Nixie_SetBuf(4,Min/10);
  69   2          Nixie_SetBuf(5,Min%10);
  70   2          Nixie_SetBuf(6,11);
  71   2          Nixie_SetBuf(7,Sec/10);
  72   2          Nixie_SetBuf(8,Sec%10);
  73   2          
  74   2          
  75   2          // ÊØè1ÁßíÂèëÈÄÅ‰∏ÄÊ¨° UART Êï∞ÊçÆ
  76   2          
  77   2          if(SendUARTFlag) {    
  78   3            // ÂÖ≥‰∏≠Êñ≠‰øùÊä§ DS18B20 Êó∂Â∫è
  79   3            EA = 0; 
  80   3            DS18B20_ConvertT(); // ËΩ¨Êç¢Ê∏©Â∫¶
  81   3            T = DS18B20_ReadT(); // ËØªÂèñÊ∏©Â∫¶
  82   3            EA = 1; // ÊÅ¢Â§ç‰∏≠Êñ≠
  83   3            tmp=(int)(T*100);     
  84   3            SendUARTFlag = 0;  // Ê∏ÖÊ†áÂøó
  85   3            sprintf(UART_Str, "%02d:%02d:%02d --> %d.%02dC\r\n",Hour, Min, Sec, tmp / 100, tmp % 100);
  86   3            UART_Busy = 1;          // ÂëäËØâ‰∏≠Êñ≠ÔºöÊàëÁé∞Âú®Âç†Áî® P3.1 ÂèëÈÄÅÊï∞ÊçÆÔºåÂà´ËØªÊåâÈîÆ
  87   3            UART_SendString(UART_Str);
  88   3            UART_Busy = 0;
  89   3          }
  90   2        }
  91   1      }
  92          
  93          /**
  94            * @brief  ÁßíË°®È©±Âä®ÂáΩÊï∞ÔºåÂú®‰∏≠Êñ≠‰∏≠Ë∞ÉÁî®
  95            * @param  Êó†
  96            * @retval Êó†
  97            */
  98          void Sec_Loop(void)
  99          {
 100   1        if(RunFlag==1)
 101   1        {
 102   2          Sec--;
 103   2          if(Sec<0)
 104   2          {
 105   3            Sec=59;
 106   3            Min--;
 107   3            if(Min<0)
 108   3            {
 109   4              Min=59;
 110   4              Hour--;
 111   4              if(Hour<0)
 112   4              { Hour=Min=Sec=0;
 113   5                RunFlag=0;
 114   5                Buzz=1;
 115   5              }
C51 COMPILER V9.57.0.0   MAIN                                                              12/24/2025 13:59:20 PAGE 3   

 116   4            }
 117   3          }
 118   2        }
 119   1      }
 120          
 121          void Timer0_Routine() interrupt 1
 122          {
 123   1        static unsigned int T0Count1,T0Count3;
 124   1        TL0 = 0x66;     
 125   1        TH0 = 0xFC;
 126   1        T0Count1++;
 127   1        if(T0Count1>=20)
 128   1        {
 129   2          T0Count1=0;
 130   2          if(UART_Busy == 0) 
 131   2          {
 132   3              Key_Loop(); 
 133   3          }
 134   2        }
 135   1      
 136   1        Nixie_Loop();//1msË∞ÉÁî®‰∏ÄÊ¨°Êï∞Á†ÅÁÆ°È©±Âä®ÂáΩÊï∞
 137   1        
 138   1        T0Count3++;
 139   1        if(T0Count3>=1000)
 140   1        {
 141   2          T0Count3=0;
 142   2          Sec_Loop(); //1sË∞ÉÁî®‰∏ÄÊ¨°Êï∞ÁßíË°®È©±Âä®ÂáΩÊï∞
 143   2          SendUARTFlag=1;
 144   2        }
 145   1      
 146   1        if(Buzz)Buzzer_Time();
 147   1            
 148   1      }
 149          void UART_Routine() interrupt 4
 150          {
 151   1        unsigned char cmd;
 152   1          
 153   1          if(RI == 1) // Â¶ÇÊûúÊé•Êî∂Ê†áÂøó‰Ωç‰∏∫1ÔºåÊé•Êî∂Âà∞‰∫ÜÊï∞ÊçÆ
 154   1          {
 155   2              cmd = SBUF; // ËØªÂèñ‰∏≤Âè£Êé•Êî∂Âà∞ÁöÑÊï∞ÊçÆ
 156   2              RI = 0;     // Êé•Êî∂Ê†áÂøó‰ΩçÊ∏Ö0
 157   2              
 158   2              // --- ÂçèËÆÆÂ§ÑÁêÜÈÄªËæë ---
 159   2              UART_SendString("CMD: RECEIVED");
 160   2            UART_SendByte(cmd);
 161   2              // Êåá‰ª§: 'S' (0x53) -> Disable/Stop Timer
 162   2              if(cmd == 'S' || cmd == 0x53)
 163   2              {
 164   3                  RunFlag = 0; // Á¶ÅÁî®/ÂÅúÊ≠¢ËÆ°Êó∂
 165   3                  // ÂèØÈÄâ: ÂèëÈÄÅÂèçÈ¶à‰ø°ÊÅØÁªôPC
 166   3                  UART_SendString("CMD: Timer Stopped\r\n");
 167   3              }
 168   2              
 169   2              // Êåá‰ª§: 'R' (0x52) -> Enable/Start Timer (ÂèØÈÄâ)
 170   2              else if(cmd == 'R' || cmd == 0x52)
 171   2              {
 172   3                  RunFlag = 1; // ÂêØÁî®/ÂºÄÂßãËÆ°Êó∂
 173   3                  UART_SendString("CMD: Timer Started\r\n");
 174   3              }
 175   2          }
 176   1      }

C51 COMPILER V9.57.0.0   MAIN                                                              12/24/2025 13:59:20 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    831    ----
   CONSTANT SIZE    =     86    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     50       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
